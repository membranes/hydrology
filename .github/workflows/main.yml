# https://github.com/marketplace/actions/build-and-push-docker-images  
name: Hydrology Project

# Later: Via the master branch only
on: [push]

jobs:

    build:
        name: Build
        runs-on: ubuntu-latest    
        steps:
          - name: Checkout
            uses: actions/checkout@v4

          - name: Set up Java
            uses: actions/setup-java@v3
            with:
                java-version: '21'
                distribution: 'temurin'
    
          - name: Build with Maven
            run: mvn -B package --file pom.xml

    docker:
        name: Docker
        runs-on: ubuntu-latest    
        steps:
            - name: checkout
              uses: actions/checkout@v4

            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
                username: ${{ secrets.DOCKER_NAME }}
                password: ${{ secrets.DOCKER_ENTRY }}

            - name: Build the Docker image
              shell: bash
              env:
                REGISTRY: 'greyhypotheses'
                REPOSITORY: 'base'
                IMAGE_TAG: 'hydrology'
              run: |
                docker build . --file Dockerfile --tag "$REGISTRY/$REPOSITORY:$IMAGE_TAG"
                docker push "$REGISTRY/$REPOSITORY:$IMAGE_TAG"
